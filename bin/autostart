#!/usr/bin/env ruby

# ---
# title:  autostart
# author: emil lenz
# email:  emillenz@protonmail.com
# date:   2023-05-07
# ---

def main
        spawn_processes
        CMDS.each { |cmd| system(cmd) }
end

CMDS = [
        'xsetroot -solid "#ffffff"', # modus-vivendi background color
        'xset dpms 0 0 0', # no screensaving (activate manually)
        'xset s off',
        'xset r off', # disable key repeat (efficiency!)
].freeze

PROCESSES = [
        'alacritty --title terminal --command tmux new-session -A -s main',
        'emacsclient --reuse-frame || emacs --daemon && emacsclient --create-frame',
        'firefox',
        "sudo xremap --watch device #{ENV['HOME']}/.config/xremap/config.yml & disown",
        'keepassxc',
        'playerctld',
        'unclutter',
        'batsignal -bpe -w 50 -c 20 -d 5',
        'i3-back',
].freeze
def spawn_processes
        processes = `ps -e`.lines.drop(1).map do |line|
                line.delete(':').split(/\s+/)[4..][0] # HACK :: delete(":") is from 'tmux: server'
        end

        PROCESSES.each do |ps|
                name = ps.split[0]
                unless processes.include?(name)
                        Process.detach(Process.spawn(ps, %i[out err] => File::NULL))
                        puts("started: #{name}")
                end
        end
end


main
