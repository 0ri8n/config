# ---
# author: emil lenz
# email:  emillenz@protonmail.com
# date:   2023-05-15
# info:
#   - the config is full of overhead reducing implementations, like: unmuting when increasing the volume, instead of introducing another shortcut to unmute the volume.  doing changes in system (eg. volume change / internet connection change) via notifications, so  we can disable the statusbar for a more focused workflow.
#   - get window title & class information using: `xprop`
#   - manual: https://i3wm.org/docs/userguide.html
# ---

# MACROS
set $ESC mode "default"
set $BIN ~/.config/bin
set $MV move container to workspace
set $SHCMD exec --no-startup-id
set $SCREENLAYOUT_MENU fd . ~/.screenlayout | rofi -dmenu -i -no-custom -p 'screen-layout' | sh

# no statusbar => using notifications to display volume change
set $VOL_INC pamixer --unmute --increase 5 && dunstify --replace 69 "vol: $(pamixer --get-volume-human)"
set $VOL_DEC pamixer --unmute --decrease 5 && dunstify --replace 69 "vol: $(pamixer --get-volume-human)"
set $VOL_MUTE pamixer --toggle-mute && dunstify --replace 69 "vol: $(pamixer --get-volume-human)"
set $MIC_MUTE pamixer --default-source --toggle-mute && dunstify --replace 69 "mic-mute: $(pamixer --default-source --get-mute)"

set $SYS_SLEEP i3lock --color ffffff && systemctl suspend
set $SYS_SCREENOFF sleep 1 && xset dpms force off

# AUTOSTART :: script
exec $BINDIR/autostart &

# OPTS
workspace_auto_back_and_forth no
workspace_layout tabbed
# NO => to navigate cross-containers
force_focus_wrapping no
default_orientation horizontal
default_border pixel 2
hide_edge_borders smart
title_align left
font pango: Iosevka Comfy 10
focus_on_window_activation focus

# KEYBINDINGS :: Mod1 <=> alt
set $MOD Mod1
floating_modifier $MOD
# Mod+button1: drag floating window
# Mod+button2: resize floating window
bindsym button2 kill
bindsym --whole-window $MOD+button2 floating toggle
# disable mousewheel functionality :: no accidental window switching
bindsym button4 nop
bindsym button5 nop

# for compatibility
bindsym XF86MonBrightnessDown $SHCMD brightnessctl set 5%-
bindsym XF86MonBrightnessUp   $SHCMD brightnessctl set 5%+
bindsym XF86Display           $SHCMD xrandr --auto
bindsym XF86ScreenSaver       $SHCMD $SYS_SCREENOFF
bindsym XF86Sleep             $SHCMD $SYS_SLEEP
bindsym XF86AudioPlay         $SHCMD playerctl play-pause
bindsym XF86AudioPause        $SHCMD playerctl play-pause
bindsym XF86AudioNext         $SHCMD playerctl next
bindsym XF86AudioPrev         $SHCMD playerctl previous
bindsym XF86AudioLowerVolume  $SHCMD $VOL_DEC
bindsym XF86AudioRaiseVolume  $SHCMD $VOL_INC
bindsym XF86AudioMute         $SHCMD $VOL_MUTE
bindsym XF86AudioMicMute      $SHCMD $MIC_MUTE

# MEDIA BINDINGS
# keep hands on the keyborad => don't use (or have) XF86 keys
bindsym $MOD+9            $SHCMD $MIC_MUTE
bindsym $MOD+0            $SHCMD $VOL_MUTE
bindsym $MOD+minus        $SHCMD $VOL_DEC
bindsym $MOD+equal        $SHCMD $VOL_INC
bindsym $MOD+bracketright $SHCMD playerctl next
bindsym $MOD+bracketleft  $SHCMD playerctl previous
bindsym $MOD+backslash    $SHCMD playerctl play-pause

# NAVIGATIONAL BINDINGS
# use MOD+shift+{n/p} to vsplit a window when needing to view things side-by-side
# n/p consistent with cycling {rofi, shell, emacs} completion menus
bindsym $MOD+p         focus left
bindsym $MOD+shift+p   move left
bindsym $MOD+n         focus right
bindsym $MOD+shift+n   move right
bindsym $MOD+q         kill
bindsym $MOD+b         $SHCMD rofi -show window
bindsym $MOD+semicolon $SHCMD rofi -show drun
bindsym $MOD+Tab       workspace back_and_forth
bindsym $MOD+Return    move workspace to output next

# WORKSPACES
for_window [urgent="latest"] focus
for_window [all] focus , title_window_icon no

# TERMINAL
set $WS_TERMINAL "terminal"
workspace $WS_TERMINAL output primary
bindsym $MOD+t workspace $WS_TERMINAL
bindsym $MOD+shift+t $TERMINAL alacritty --command tmux new-session -A -s main
for_window [class="(?i)alacritty"] $MV $WS_TERMINAL, focus

# READER :: EBOOKS, DOCUMENTS
set $WS_READER "reader"
workspace $WS_READER output primary
bindsym $MOD+r workspace $WS_READER
bindsym $MOD+shift+r $SHCMD $BINDIR/find-file-menu fd '.' --extension pdf -e epub --base-directory ~/Documents literature ethz/cs/s3
for_window [class="(?i)zathura"] $MV $WS_READER, focus

# WEBBROWSER
set $WS_WEB "web"
workspace $WS_WEB output primary
bindsym $MOD+w workspace $WS_WEB
bindsym $MOD+shift+w $SHCMD firefox --new-window
for_window [class="(?i)firefox"] $MV $WS_WEB, focus

# EDITOR
set $WS_EDITOR "editor"
workspace $WS_EDITOR output primary
bindsym $MOD+e workspace $WS_EDITOR
bindsym $MOD+shift+e $SHCMD emacsclient --reuse-frame || emacs --daemon && emacsclient --reuse-frame
for_window [class="(?i)emacs"] $MV $WS_EDITOR, focus

# MEDIA :: IMAGES, VIDEOS, AUDIO
set $WS_MEDIA "media"
workspace $WS_MEDIA output primary
bindsym $MOD+m workspace $WS_MEDIA
bindsym $MOD+shift+m $SHCMD firefox --new-window https://open.spotify.com
for_window [class="(?i)mpv|nsxiv"] $MV $WS_MEDIA, focus
for_window [class="(?i)firefox" title="(?i)spotify"] $MV $WS_MEDIA, focus

# AI :: CHATBOT, AI-TOOLS
set $WS_AI "ai"
workspace $WS_AI output primary
bindsym $MOD+a workspace $WS_AI
bindsym $MOD+shift+a $SHCMD firefox --new-window https://chat.openai.com
for_window [class="(?i)firefox" title="(?i)chatgpt"] $MV $WS_AI, focus

# LEADERMODE
bindsym $MOD+space mode "leader"
mode "leader" {
        bindsym $MOD+a $SHCMD $BINDIR/audio-output-menu; $ESC
        bindsym $MOD+b $SHCMD $BINDIR/bluetooth-menu; $ESC
        bindsym $MOD+k $SHCMD $BINDIR/killprocess-menu; $ESC
        bindsym $MOD+d $SHCMD $SCREENLAYOUT_MENU; $ESC

        # NOTE :: after screenshot is taken, the path is written to clipboard (overheadfree)
        bindsym --release $MOD+s $SHCMD scrot --select --file "$HOME/Pictures/screenshots/%Y-%m-%d_T%H-%M.png" --exec 'dunstify "screenshot" "$f" && echo $f | xclip -selection clipboard'; $ESC
        bindsym $MOD+shift+s $SHCMD scrot --file "$HOME/Pictures/screenshots/%Y-%m-%d_T%H-%M.png" --exec 'dunstify "screenshot" "$f" && echo $f | xclip -selection clipboard'; $ESC

        bindsym $MOD+e $SHCMD emacsclient --eval "(emacs-everywhere)"; $ESC

        # copy browser link to clipboard and open it in mpv:
        bindsym $MOD+m $SHCMD mpv "$(xclip -out)"; $ESC

        bindsym $MOD+q $SHCMD $SYS_SLEEP; $ESC
        bindsym $MOD+o $SHCMD $SYS_SCREENOFF; $ESC

        bindsym $MOD+f $SHCMD $BINDIR/find-file-menu fd '.' --extension pdf -e epub --base-directory ~/ Documents/literature Documents/ethz/cs/s3 Downloads; $ESC

        bindsym Escape mode "default"
}

# MODUS-OPERANDI THEME
set $BG          #ffffff
set $FG          #000000
set $MODELINE_BG #c8c8c8
set $BORDER      #9f9f9f
set $ACTIVE_BG   #c0deff
set $URGENT_BG   #ff8f88

# element               $border    $bg          $fg $mark $border (child)
client.focused          $ACTIVE_BG $ACTIVE_BG   $FG $FG   $ACTIVE_BG
client.focused_inactive $BORDER    $MODELINE_BG $FG $FG   $BORDER
client.unfocused        $BORDER    $MODELINE_BG $FG $FG   $BORDER
client.urgent           $URGENT_BG $URGENT_BG   $FG $FG   $URGENT_BG
client.background       $BG

# MODELINE
bar {
        mode hide
        # only show if explicitly activated using leader mode
        hidden_state hide
        workspace_buttons yes
        binding_mode_indicator yes
        modifier none
        tray_output primary
        status_command i3status
        separator_symbol " | "

        colors {
                background $MODELINE_BG
                statusline $FG
                separator  $FG
                #class             $border $bg          $fg
                binding_mode       $BORDER $ACTIVE_BG   $FG
                focused_workspace  $BORDER $ACTIVE_BG   $FG
                active_workspace   $BORDER $MODELINE_BG $FG
                inactive_workspace $BORDER $MODELINE_BG $FG
                urgent_workspace   $BORDER $URGENT_BG   $FG
        }
}
